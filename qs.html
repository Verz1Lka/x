<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<span id="results"></span>
<body>

</body>
</html>
<script>
    function testToStringInterception() {
        // Сохраняем исходные ссылки на методы.
        const originalFunctionToString = Function.prototype.toString;
        const originalObjectToString = Object.prototype.toString;

        let functionToStringCalls = 0;
        let objectToStringCalls = 0;

        try {
            // Подменяем Function.prototype.toString.
            Function.prototype.toString = function() {
                functionToStringCalls++;
                // Возвращаем фиктивную строку, чтобы не ломать логику где-то в коде.
                return "function override placeholder";
            };

            // Подменяем Object.prototype.toString.
            Object.prototype.toString = function() {
                objectToStringCalls++;
                return "object override placeholder";
            };

            // Выполним несколько действий,
            // чтобы проявились вызовы подменённых методов:
            console.log("Проверка перехвата toString...");

            // Явный вызов toString у функции:
            (function exampleFunction() {}).toString();
            // Явный вызов toString у объекта:
            ({}).toString();

            // Возвращаем счетчики
            return [functionToStringCalls, objectToStringCalls];
        } catch (error) {
            // Если что-то пошло не так, вернём признак ошибки
            return [-1, -1];
        } finally {
            // Восстанавливаем исходные методы в любом случае.
            Function.prototype.toString = originalFunctionToString;
            Object.prototype.toString = originalObjectToString;
        }
    }

    // Пример использования:
    const [fnCalls, objCalls] = testToStringInterception();
    console.log("Function toString calls:", fnCalls);
    console.log("Object toString calls:  ", objCalls);
  document.getElementById("results").innerHTML = JSON.stringify([fnCalls, objCalls]);
  // console.log("Function toString calls:", fnCalls);
  // console.log("Object toString calls:  ", objCalls);
</script>